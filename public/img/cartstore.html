<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body>Cartsore<br>import { create } from 'zustand';<br>import { persist } from 'zustand/middleware';<br>import { CartItem, CartStore } from '@/types/cart';<br>import { Product } from '@/types/product';<br><br>// Fonction pour calculer le total du panier<br>function calculateTotal(items: CartItem[]): number {<br>&nbsp; return <a href="http://items.reduce">items.reduce</a>((sum, item) =&gt; sum + <a href="http://item.price">item.price</a> * <a href="http://item.quantity">item.quantity</a>, 0);<br>}<br><br>// Création du store avec persistance<br>export const useCartStore = create&lt;CartStore&gt;()(<br>&nbsp; persist(<br>&nbsp;&nbsp;&nbsp; (set) =&gt; ({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // État initial<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: [],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total: 0,<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Ajouter un produit au panier<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addItem: (product: Product) =&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set((state) =&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const existingItem = <a href="http://state.items.find">state.items.find</a>((item) =&gt; <a href="http://item.id">item.id</a> === <a href="http://product.id">product.id</a>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (existingItem) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Si le produit existe déjà, augmenter la quantité<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const updatedItems = <a href="http://state.items.map">state.items.map</a>((item) =&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://item.id">item.id</a> === <a href="http://product.id">product.id</a><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ? { ...item, quantity: <a href="http://item.quantity">item.quantity</a> + 1 }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : item<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: updatedItems,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total: calculateTotal(updatedItems),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Si le produit n'existe pas, l'ajouter avec quantité 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const newItems = [...<a href="http://state.items">state.items</a>, { ...product, quantity: 1 }];<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: newItems,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total: calculateTotal(newItems),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Supprimer un produit du panier<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; removeItem: (productId: number) =&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set((state) =&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const newItems = <a href="http://state.items.filter">state.items.filter</a>((item) =&gt; <a href="http://item.id">item.id</a> !== productId);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: newItems,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total: calculateTotal(newItems),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Mettre à jour la quantité d'un produit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; updateQuantity: (productId: number, quantity: number) =&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (quantity &lt; 1) return;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set((state) =&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const updatedItems = <a href="http://state.items.map">state.items.map</a>((item) =&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://item.id">item.id</a> === productId ? { ...item, quantity } : item<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; items: updatedItems,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; total: calculateTotal(updatedItems),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Vider le panier<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; clearCart: () =&gt; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set({ items: [], total: 0 });<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br>&nbsp;&nbsp;&nbsp; }),<br>&nbsp;&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; name: 'shopping-cart',<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; skipHydration: true,<br>&nbsp;&nbsp;&nbsp; }<br>&nbsp; )<br>);</body></html>